<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>批量IP地址解析工具</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { text-align: center; color: #333; }
    textarea { width: 100%; height: 150px; padding: 10px; font-size: 14px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 14px; }
    th { background: #007BFF; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
</style>
</head>
<body>
    <h1>批量IP地址解析工具（IPv4 + IPv6）</h1>
    <p>每行一个 IP（最多 6000 个）</p>
    <textarea id="ipList" placeholder="输入IP地址，一行一个，例如：&#10;8.8.8.8&#10;2001:4860:4860::8888"></textarea>
    <br>
    <button onclick="startLookup()">开始解析</button>
    <table id="resultTable">
        <thead>
            <tr>
                <th>IP地址</th>
                <th>国家</th>
                <th>地区</th>
                <th>城市</th>
                <th>运营商</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
async function lookupIP(ip) {
    try {
        let res = await fetch(`https://ipwho.is/${ip}`);
        let data = await res.json();
        if (!data.success) {
            return { ip: ip, country: "无效IP", region: "-", city: "-", isp: "-" };
        }
        return {
            ip: ip,
            country: data.country || "-",
            region: data.region || "-",
            city: data.city || "-",
            isp: data.connection ? data.connection.org : "-"
        };
    } catch (err) {
        return { ip: ip, country: "解析失败", region: "-", city: "-", isp: "-" };
    }
}

async function startLookup() {
    let ipText = document.getElementById("ipList").value.trim();
    if (!ipText) {
        alert("请输入至少一个IP地址");
        return;
    }

    let ips = ipText.split("\n").map(ip => ip.trim()).filter(ip => ip);
    if (ips.length > 6000) {
        alert("一次最多解析 6000 个 IP");
        return;
    }

    let tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";

    for (let ip of ips) {
        let row = tbody.insertRow();
        row.insertCell(0).innerText = ip;
        let loadingCell = row.insertCell(1);
        loadingCell.colSpan = 4;
        loadingCell.innerText = "解析中...";
        let result = await lookupIP(ip);
        row.deleteCell(1); // 删除加载中的合并单元格
        row.insertCell(1).innerText = result.country;
        row.insertCell(2).innerText = result.region;
        row.insertCell(3).innerText = result.city;
        row.insertCell(4).innerText = result.isp;
    }
}
</script>
</body>
</html>
