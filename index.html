<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>批量IP地址解析工具</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #333; }
    textarea { width: 100%; height: 150px; }
    button { padding: 10px 20px; margin-top: 10px; cursor: pointer; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    .loading { color: blue; }
    .error { color: red; }
</style>
</head>
<body>
<h1>批量IP地址解析工具（CORS代理版）</h1>
<p>请输入要解析的 IPv4 或 IPv6 地址（每行一个，最多 6000 个）：</p>
<textarea id="ipList" placeholder="例如：
8.8.8.8
2001:4860:4860::8888"></textarea><br>
<button onclick="parseIPs()">开始解析</button>
<div id="status"></div>
<table id="resultTable" style="display:none;">
    <thead>
        <tr>
            <th>IP 地址</th>
            <th>类型</th>
            <th>国家</th>
            <th>地区</th>
            <th>城市</th>
            <th>经度</th>
            <th>纬度</th>
            <th>ISP</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
async function parseIPs() {
    const textarea = document.getElementById('ipList');
    const statusDiv = document.getElementById('status');
    const resultTable = document.getElementById('resultTable');
    const tbody = resultTable.querySelector('tbody');

    let ips = textarea.value.split(/\n+/).map(ip => ip.trim()).filter(ip => ip.length > 0);
    if (ips.length === 0) {
        alert('请输入至少一个有效的 IP 地址');
        return;
    }
    if (ips.length > 6000) {
        alert('一次最多解析 6000 个 IP 地址');
        return;
    }

    statusDiv.innerHTML = `<p class="loading">正在解析 ${ips.length} 个 IP 地址，请稍候...</p>`;
    tbody.innerHTML = '';
    resultTable.style.display = 'none';

    for (let ip of ips) {
        let row = tbody.insertRow();
        row.insertCell(0).innerText = ip;
        for (let i=1;i<8;i++) row.insertCell(i).innerText = '解析中...';

        try {
            let res = await fetch(`https://corsproxy.io/?https://ipwho.is/${ip}`);
            let data = await res.json();
            if(data.success){
                row.cells[1].innerText = data.type || '-';
                row.cells[2].innerText = data.country || '-';
                row.cells[3].innerText = data.region || '-';
                row.cells[4].innerText = data.city || '-';
                row.cells[5].innerText = data.longitude || '-';
                row.cells[6].innerText = data.latitude || '-';
                row.cells[7].innerText = data.connection?.org || '-';
            } else {
                for(let i=1;i<8;i++) {
                    row.cells[i].innerText = '解析失败';
                    row.cells[i].classList.add('error');
                }
            }
        } catch(err){
            for(let i=1;i<8;i++){
                row.cells[i].innerText = '请求错误';
                row.cells[i].classList.add('error');
            }
        }
    }

    statusDiv.innerHTML = `<p>解析完成，共 ${ips.length} 个 IP。</p>`;
    resultTable.style.display = 'table';
}
</script>
</body>
</html>
