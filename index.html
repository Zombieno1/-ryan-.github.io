<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>批量IP地址解析工具</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h1 { text-align: center; color: #333; }
    textarea { width: 100%; height: 150px; padding: 10px; font-size: 14px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; font-size: 14px; }
    th { background: #007BFF; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    .error { background-color: #ffcccc !important; }
</style>
</head>
<body>
    <h1>批量IP地址解析工具（IPv4 + IPv6）</h1>
    <p>每行或逗号分隔一个 IP（最多 6000 个）</p>
    <textarea id="ipList" placeholder="输入IP地址，例如：
8.8.8.8
2001:4860:4860::8888"></textarea>
    <br>
    <button onclick="startLookup()">开始解析</button>
    <table id="resultTable">
        <thead>
            <tr>
                <th>IP地址</th>
                <th>类型</th>
                <th>国家</th>
                <th>地区</th>
                <th>城市</th>
                <th>经纬度</th>
                <th>运营商</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
async function lookupIP(ip) {
    try {
        let res = await fetch(`https://ipwho.is/${ip}`);
        let data = await res.json();
        if (!data.success) {
            return { ip, type: "-", country: "无效", region: "-", city: "-", loc: "-", isp: "-", error: true };
        }
        return {
            ip,
            type: data.type || "-",
            country: data.country || "-",
            region: data.region || "-",
            city: data.city || "-",
            loc: (data.latitude && data.longitude) ? `${data.latitude}, ${data.longitude}` : "-",
            isp: data.connection?.org || "-",
            error: false
        };
    } catch (err) {
        return { ip, type: "-", country: "解析失败", region: "-", city: "-", loc: "-", isp: "-", error: true };
    }
}

async function startLookup() {
    let ipText = document.getElementById("ipList").value.trim();
    if (!ipText) {
        alert("请输入至少一个IP地址");
        return;
    }

    let ips = ipText.split(/[\n,]+/).map(ip => ip.trim()).filter(ip => ip);
    if (ips.length > 6000) {
        alert("一次最多解析 6000 个 IP");
        return;
    }

    let tbody = document.querySelector("#resultTable tbody");
    tbody.innerHTML = "";

    for (let ip of ips) {
        let row = tbody.insertRow();
        row.insertCell(0).innerText = ip;
        for (let i = 0; i < 6; i++) row.insertCell(i+1).innerText = "解析中...";
        
        let result = await lookupIP(ip);

        row.cells[1].innerText = result.type;
        row.cells[2].innerText = result.country;
        row.cells[3].innerText = result.region;
        row.cells[4].innerText = result.city;
        row.cells[5].innerText = result.loc;
        row.cells[6].innerText = result.isp;

        if (result.error) row.classList.add("error");
    }
}
</script>
</body>
</html>
